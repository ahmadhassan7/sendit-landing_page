/*! maska v2.1.1 | (c) Alexander Shabunevich | Released under the MIT license */
(function(l,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(l=typeof globalThis<"u"?globalThis:l||self,p(l.Maska={}))})(this,function(l){"use strict";var N=Object.defineProperty;var V=(l,p,u)=>p in l?N(l,p,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[p]=u;var g=(l,p,u)=>(V(l,typeof p!="symbol"?p+"":p,u),u);const p={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class u{constructor(t={}){g(this,"opts",{});g(this,"memo",new Map);var e;const s={...t};if(s.tokens!=null){s.tokens=s.tokensReplace?{...s.tokens}:{...p,...s.tokens};for(const n of Object.values(s.tokens))typeof n.pattern=="string"&&(n.pattern=new RegExp(n.pattern))}else s.tokens=p;Array.isArray(s.mask)&&(s.mask.length>1?s.mask.sort((n,i)=>n.length-i.length):s.mask=(e=s.mask[0])!=null?e:""),s.mask===""&&(s.mask=null),this.opts=s}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const s=this.findMask(t);if(this.opts.mask==null||s==null)return!1;const e=this.process(t,s).length;return typeof this.opts.mask=="string"?e>=this.opts.mask.length:typeof this.opts.mask=="function"?e>=s.length:this.opts.mask.filter(n=>e>=n.length).length===this.opts.mask.length}findMask(t){var n,i;const s=this.opts.mask;if(s==null)return null;if(typeof s=="string")return s;if(typeof s=="function")return s(t);const e=this.process(t,(n=s.slice(-1).pop())!=null?n:"",!1);return(i=s.find(f=>this.process(t,f,!1).length>=e.length))!=null?i:""}escapeMask(t){const s=[],e=[];return t.split("").forEach((n,i)=>{n==="!"&&t[i-1]!=="!"?e.push(i-e.length):s.push(n)}),{mask:s.join(""),escaped:e}}process(t,s,e=!0){var b;if(s==null)return t;const n=`value=${t},mask=${s},masked=${e?1:0}`;if(this.memo.has(n))return this.memo.get(n);const{mask:i,escaped:f}=this.escapeMask(s),h=[],d=this.opts.tokens!=null?this.opts.tokens:{},r=this.isReversed()?-1:1,E=this.isReversed()?"unshift":"push",y=this.isReversed()?0:i.length-1,j=this.isReversed()?()=>o>-1&&c>-1:()=>o<i.length&&c<t.length,I=m=>!this.isReversed()&&m<=y||this.isReversed()&&m>=y;let R,M=-1,o=this.isReversed()?i.length-1:0,c=this.isReversed()?t.length-1:0;for(;j();){const m=i.charAt(o),k=d[m],v=(k==null?void 0:k.transform)!=null?k.transform(t.charAt(c)):t.charAt(c);if(!f.includes(o)&&k!=null){if(v.match(k.pattern)!=null)h[E](v),k.repeated?(M===-1?M=o:o===y&&o!==M&&(o=M-r),y===M&&(o-=r)):k.multiple&&(o-=r),o+=r;else if(k.multiple){const J=((b=h[c-r])==null?void 0:b.match(k.pattern))!=null,C=i.charAt(o+r);J&&C!==""&&d[C]==null?(o+=r,c-=r):h[E]("")}else v===R?R=void 0:k.optional&&(o+=r,c-=r);c+=r}else e&&!this.isEager()&&h[E](m),v===m&&!this.isEager()?c+=r:R=m,this.isEager()||(o+=r);if(this.isEager())for(;I(o)&&(d[i.charAt(o)]==null||f.includes(o));)e?h[E](i.charAt(o)):i.charAt(o)===t.charAt(c)&&(c+=r),o+=r}return this.memo.set(n,h.join("")),this.memo.get(n)}}const T=a=>JSON.parse(a.replaceAll("'",'"')),w=(a,t={})=>{const s={...t};return a.dataset.maska!=null&&a.dataset.maska!==""&&(s.mask=P(a.dataset.maska)),a.dataset.maskaEager!=null&&(s.eager=A(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(s.reversed=A(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(s.tokensReplace=A(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(s.tokens=W(a.dataset.maskaTokens)),s},A=a=>a!==""?Boolean(JSON.parse(a)):!0,P=a=>a.startsWith("[")&&a.endsWith("]")?T(a):a,W=a=>{if(a.startsWith("{")&&a.endsWith("}"))return T(a);const t={};return a.split("|").forEach(s=>{const e=s.split(":");t[e[0]]={pattern:new RegExp(e[1]),optional:e[2]==="optional",multiple:e[2]==="multiple",repeated:e[2]==="repeated"}}),t};class O{constructor(t,s={}){g(this,"items",new Map);g(this,"beforeinputEvent",t=>{const s=t.target,e=this.items.get(s);e.isEager()&&"inputType"in t&&t.inputType.startsWith("delete")&&e.unmasked(s.value).length<=1&&this.setMaskedValue(s,"")});g(this,"inputEvent",t=>{if(t instanceof CustomEvent&&t.type==="input"&&t.detail!=null&&"masked"in t.detail)return;const s=t.target,e=this.items.get(s),n=s.value,i=s.selectionStart,f=s.selectionEnd;let h=n;if(e.isEager()){const d=e.unmasked(n),r=e.masked(d);d===""&&"data"in t&&t.data!=null?h=t.data:(r.startsWith(n)||e.completed(d))&&(h=d)}this.setMaskedValue(s,h),"inputType"in t&&(t.inputType.startsWith("delete")||i!=null&&i<n.length)&&s.setSelectionRange(i,f)});this.options=s,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(s)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(s))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdate(t,s){const e=this.items.get(t),n=new u(w(t,this.getMaskOpts(s)));return JSON.stringify(e.opts)!==JSON.stringify(n.opts)}getMaskOpts(t){const{onMaska:s,preProcess:e,postProcess:n,...i}=t;return i}init(t,s){for(const e of t){const n=new u(w(e,s));this.items.set(e,n),e.value!==""&&this.setMaskedValue(e,e.value),e.addEventListener("input",this.inputEvent),e.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,s){const e=this.items.get(t);this.options.preProcess!=null&&(s=this.options.preProcess(s)),s=e.masked(s),this.options.postProcess!=null&&(s=this.options.postProcess(s)),t.value=s;const n={masked:e.masked(s),unmasked:e.unmasked(s),completed:e.completed(s)};this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(i=>i(n)):this.options.onMaska(n)),t.dispatchEvent(new CustomEvent("maska",{detail:n})),t.dispatchEvent(new CustomEvent("input",{detail:n}))}}const S=new WeakMap,L=(a,t)=>{const s=a instanceof HTMLInputElement?a:a.querySelector("input"),e={...t.arg};if(s==null)return;const n=S.get(s);if(n!=null){if(!n.needUpdate(s,e))return;n.destroy()}if(t.value!=null){const i=t.value,f=h=>{i.masked=h.masked,i.unmasked=h.unmasked,i.completed=h.completed};e.onMaska=e.onMaska==null?f:Array.isArray(e.onMaska)?[...e.onMaska,f]:[e.onMaska,f]}S.set(s,new O(s,e)),setTimeout(()=>{s.value!==""&&s.dispatchEvent(new InputEvent("input"))})};l.Mask=u,l.MaskInput=O,l.tokens=p,l.vMaska=L,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
