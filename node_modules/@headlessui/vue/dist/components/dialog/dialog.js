import{computed as g,defineComponent as b,h,inject as N,nextTick as ee,onMounted as M,onUnmounted as te,provide as le,ref as S,watchEffect as V}from"vue";import{render as P,Features as Y}from'../../utils/render.js';import{Keys as oe}from'../../keyboard.js';import{useId as w}from'../../hooks/use-id.js';import{FocusTrap as R}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as ae}from'../../hooks/use-inert-others.js';import{Portal as _,PortalGroup as ie}from'../portal/portal.js';import{StackMessage as U,useStackProvider as re}from'../../internal/stack-context.js';import{match as F}from'../../utils/match.js';import{ForcePortalRoot as $}from'../../internal/portal-force-root.js';import{Description as ne,useDescriptions as ue}from'../description/description.js';import{dom as q}from'../../utils/dom.js';import{useOpenClosed as se,State as G}from'../../internal/open-closed.js';import{useOutsideClick as pe}from'../../hooks/use-outside-click.js';import{getOwnerDocument as de}from'../../utils/owner.js';import{useEventListener as fe}from'../../hooks/use-event-listener.js';import{Hidden as ge,Features as ce}from'../../internal/hidden.js';import{disposables as me}from'../../utils/disposables.js';import{isIOS as ve}from'../../utils/platform.js';var De=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(De||{});let j=Symbol("DialogContext");function T(o){let n=N(j,null);if(n===null){let t=new Error(`<${o} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,T),t}return n}let k="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ke=b({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:k},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${w()}`}},emits:{close:o=>!0},setup(o,{emit:n,attrs:t,slots:s,expose:u}){var A;let a=S(!1);M(()=>{a.value=!0});let p=S(0),m=se(),v=g(()=>o.open===k&&m!==null?F(m.value,{[G.Open]:!0,[G.Closed]:!1}):o.open),x=S(new Set),c=S(null),B=S(null),I=g(()=>de(c));if(u({el:c,$el:c}),!(o.open!==k||m!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof v.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${v.value===k?void 0:o.open}`);let f=g(()=>a.value&&v.value?0:1),H=g(()=>f.value===0),C=g(()=>p.value>1),z=N(j,null)!==null,J=g(()=>C.value?"parent":"leaf");ae(c,g(()=>C.value?H.value:!1)),re({type:"Dialog",enabled:g(()=>f.value===0),element:c,onUpdate:(i,l,r)=>{if(l==="Dialog")return F(i,{[U.Add](){x.value.add(r),p.value+=1},[U.Remove](){x.value.delete(r),p.value-=1}})}});let Q=ue({name:"DialogDescription",slot:g(()=>({open:v.value}))}),E=S(null),y={titleId:E,panelRef:S(null),dialogState:f,setTitleId(i){E.value!==i&&(E.value=i)},close(){n("close",!1)}};return le(j,y),pe(()=>{var l,r,d;return[...Array.from((r=(l=I.value)==null?void 0:l.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?r:[]).filter(e=>!(!(e instanceof HTMLElement)||e.contains(q(B))||y.panelRef.value&&e.contains(y.panelRef.value))),(d=y.panelRef.value)!=null?d:c.value]},(i,l)=>{y.close(),ee(()=>l==null?void 0:l.focus())},g(()=>f.value===0&&!C.value)),fe((A=I.value)==null?void 0:A.defaultView,"keydown",i=>{i.defaultPrevented||i.key===oe.Escape&&f.value===0&&(C.value||(i.preventDefault(),i.stopPropagation(),y.close()))}),V(i=>{var K;if(f.value!==0||z)return;let l=I.value;if(!l)return;let r=me();function d(D,O,X){let Z=D.style.getPropertyValue(O);return Object.assign(D.style,{[O]:X}),r.add(()=>{Object.assign(D.style,{[O]:Z})})}let e=l==null?void 0:l.documentElement,W=((K=l.defaultView)!=null?K:window).innerWidth-e.clientWidth;if(d(e,"overflow","hidden"),W>0){let D=e.clientWidth-e.offsetWidth,O=W-D;d(e,"paddingRight",`${O}px`)}if(ve()){let D=window.pageYOffset;d(e,"position","fixed"),d(e,"marginTop",`-${D}px`),d(e,"width","100%"),r.add(()=>window.scrollTo(0,D))}i(r.dispose)}),V(i=>{if(f.value!==0)return;let l=q(c);if(!l)return;let r=new IntersectionObserver(d=>{for(let e of d)e.boundingClientRect.x===0&&e.boundingClientRect.y===0&&e.boundingClientRect.width===0&&e.boundingClientRect.height===0&&y.close()});r.observe(l),i(()=>r.disconnect())}),()=>{let{id:i,open:l,initialFocus:r,...d}=o,e={...t,ref:c,id:i,role:"dialog","aria-modal":f.value===0?!0:void 0,"aria-labelledby":E.value,"aria-describedby":Q.value},L={open:f.value===0};return h($,{force:!0},()=>[h(_,()=>h(ie,{target:c.value},()=>h($,{force:!1},()=>h(R,{initialFocus:r,containers:x,features:H.value?F(J.value,{parent:R.features.RestoreFocus,leaf:R.features.All&~R.features.FocusLock}):R.features.None},()=>P({ourProps:e,theirProps:d,slot:L,attrs:t,slots:s,visible:f.value===0,features:Y.RenderStrategy|Y.Static,name:"Dialog"}))))),h(ge,{features:ce.Hidden,ref:B})])}}}),Ne=b({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-overlay-${w()}`}},setup(o,{attrs:n,slots:t}){let s=T("DialogOverlay");function u(a){a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),s.close())}return()=>{let{id:a,...p}=o;return P({ourProps:{id:a,"aria-hidden":!0,onClick:u},theirProps:p,slot:{open:s.dialogState.value===0},attrs:n,slots:t,name:"DialogOverlay"})}}}),Ve=b({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-backdrop-${w()}`}},inheritAttrs:!1,setup(o,{attrs:n,slots:t,expose:s}){let u=T("DialogBackdrop"),a=S(null);return s({el:a,$el:a}),M(()=>{if(u.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let{id:p,...m}=o,v={id:p,ref:a,"aria-hidden":!0};return h($,{force:!0},()=>h(_,()=>P({ourProps:v,theirProps:{...n,...m},slot:{open:u.dialogState.value===0},attrs:n,slots:t,name:"DialogBackdrop"})))}}}),Ye=b({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${w()}`}},setup(o,{attrs:n,slots:t,expose:s}){let u=T("DialogPanel");s({el:u.panelRef,$el:u.panelRef});function a(p){p.stopPropagation()}return()=>{let{id:p,...m}=o,v={id:p,ref:u.panelRef,onClick:a};return P({ourProps:v,theirProps:m,slot:{open:u.dialogState.value===0},attrs:n,slots:t,name:"DialogPanel"})}}}),_e=b({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:()=>`headlessui-dialog-title-${w()}`}},setup(o,{attrs:n,slots:t}){let s=T("DialogTitle");return M(()=>{s.setTitleId(o.id),te(()=>s.setTitleId(null))}),()=>{let{id:u,...a}=o;return P({ourProps:{id:u},theirProps:a,slot:{open:s.dialogState.value===0},attrs:n,slots:t,name:"DialogTitle"})}}}),Ue=ne;export{Ke as Dialog,Ve as DialogBackdrop,Ue as DialogDescription,Ne as DialogOverlay,Ye as DialogPanel,_e as DialogTitle};
