import{computed as m,defineComponent as k,h as d,onMounted as v,onUnmounted as H,ref as T,watch as R,Fragment as P}from"vue";import{render as B}from'../../utils/render.js';import{Hidden as M,Features as D}from'../../internal/hidden.js';import{dom as L}from'../../utils/dom.js';import{focusIn as b,Focus as F,focusElement as E,FocusResult as I}from'../../utils/focus-management.js';import{match as S}from'../../utils/match.js';import{useTabDirection as g,Direction as w}from'../../hooks/use-tab-direction.js';import{getOwnerDocument as N}from'../../utils/owner.js';import{useEventListener as O}from'../../hooks/use-event-listener.js';import{microTask as j}from'../../utils/micro-task.js';var h=(e=>(e[e.None=1]="None",e[e.InitialFocus=2]="InitialFocus",e[e.TabLock=4]="TabLock",e[e.FocusLock=8]="FocusLock",e[e.RestoreFocus=16]="RestoreFocus",e[e.All=30]="All",e))(h||{});let ee=Object.assign(k({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:Object,default:T(new Set)}},inheritAttrs:!1,setup(u,{attrs:a,slots:t,expose:r}){let n=T(null);r({el:n,$el:n});let o=m(()=>N(n));A({ownerDocument:o},m(()=>Boolean(u.features&16)));let e=C({ownerDocument:o,container:n,initialFocus:m(()=>u.initialFocus)},m(()=>Boolean(u.features&2)));_({ownerDocument:o,container:n,containers:u.containers,previousActiveElement:e},m(()=>Boolean(u.features&8)));let s=g();function i(){let l=L(n);!l||S(s.value,{[w.Forwards]:()=>b(l,F.First),[w.Backwards]:()=>b(l,F.Last)})}return()=>{let l={},c={ref:n},{features:f,initialFocus:p,containers:U,...y}=u;return d(P,[Boolean(f&4)&&d(M,{as:"button",type:"button",onFocus:i,features:D.Focusable}),B({ourProps:c,theirProps:{...a,...y},slot:l,attrs:a,slots:t,name:"FocusTrap"}),Boolean(f&4)&&d(M,{as:"button",type:"button",onFocus:i,features:D.Focusable})])}}}),{features:h});function A({ownerDocument:u},a){let t=T(null);function r(){var o;t.value||(t.value=(o=u.value)==null?void 0:o.activeElement)}function n(){!t.value||(E(t.value),t.value=null)}v(()=>{R(a,(o,e)=>{o!==e&&(o?r():n())},{immediate:!0})}),H(n)}function C({ownerDocument:u,container:a,initialFocus:t},r){let n=T(null),o=T(!1);return v(()=>o.value=!0),H(()=>o.value=!1),v(()=>{R([a,t,r],(e,s)=>{if(e.every((l,c)=>(s==null?void 0:s[c])===l)||!r.value)return;let i=L(a);!i||j(()=>{var f,p;if(!o.value)return;let l=L(t),c=(f=u.value)==null?void 0:f.activeElement;if(l){if(l===c){n.value=c;return}}else if(i.contains(c)){n.value=c;return}l?E(l):b(i,F.First|F.NoScroll)===I.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),n.value=(p=u.value)==null?void 0:p.activeElement})},{immediate:!0,flush:"post"})}),n}function _({ownerDocument:u,container:a,containers:t,previousActiveElement:r},n){var o;O((o=u.value)==null?void 0:o.defaultView,"focus",e=>{if(!n.value)return;let s=new Set(t==null?void 0:t.value);s.add(a);let i=r.value;if(!i)return;let l=e.target;l&&l instanceof HTMLElement?x(s,l)?(r.value=l,E(l)):(e.preventDefault(),e.stopPropagation(),E(i)):E(r.value)},!0)}function x(u,a){var t;for(let r of u)if((t=r.value)!=null&&t.contains(a))return!0;return!1}export{ee as FocusTrap};
